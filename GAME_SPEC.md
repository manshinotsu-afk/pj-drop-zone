# DROP ZONE ゲーム仕様書

## 1. 概要

**DROP ZONE** は、10×10 のグリッド上で 4 体のプレイヤーがパネルに乗り、攻撃でパネルを落下させて相手を落とす対戦ゲームです。1P は人間、2P・3P・4P は CPU が操作します。最後までパネルに残った 1 体が勝ちです。

---

## 2. フィールド

| 項目 | 内容 |
|------|------|
| サイズ | **10×10** マス（座標は 0〜9） |
| 1 マス | パネルあり / なしの 2 状態 |
| 座標 | `x`: 左 0 〜 右 9、`y`: 下 0 〜 上 9（画面下が y=0） |
| 初期状態 | 全マスにパネルあり |

- パネルがないマスに立っているプレイヤーは **即落下（死亡）** になります。
- 落下したパネルは **5 秒後** に 0.2 秒の演出を経て復活し、再び乗れるようになります。

---

## 3. プレイヤー

### 3.1 人数・操作

| プレイヤー | 操作 | 備考 |
|------------|------|------|
| **1P** | 人間（キーボード） | プレイ可能 |
| **2P** | CPU | 自動操作 |
| **3P** | CPU | 自動操作 |
| **4P** | CPU | 自動操作 |

### 3.2 初期配置・向き

| プレイヤー | 位置 (x, y) | 初期向き |
|------------|-------------|----------|
| 1P | (4, 0) | 上 (up) |
| 2P | (5, 9) | 下 (down) |
| 3P | (9, 4) | 左 (left) |
| 4P | (0, 5) | 右 (right) |

### 3.3 同一マス

- **2 体以上が同じマスに乗ることはできません。** 移動先に他プレイヤーがいると、その方向への移動はできません。

---

## 4. 操作（1P）

### 4.1 キー割り当て

| キー | 操作 |
|------|------|
| **W** | 上方向へ移動 / 向きを上に |
| **S** | 下方向へ移動 / 向きを下に |
| **A** | 左方向へ移動 / 向きを左に |
| **D** | 右方向へ移動 / 向きを右に |
| **Space** | 攻撃発動 / タイトルでスタート / リザルトで再戦 |

### 4.2 向き

- 方向キーで **向き** を変更できます。リアルタイムに反映されます。
- 攻撃は **現在の向いている方向** に発動します。

### 4.3 移動

- 方向キーで **隣接マス** に 1 マスずつ移動します。
- 移動先にパネルがあり、かつ他プレイヤーがいない場合のみ移動できます。
- 移動後は **0.2 秒** の硬直があり、その間は次の移動を開始できません。
- 現在、1 マス移動時間は **0 秒**（即時移動）に設定されています。

---

## 5. 攻撃

### 5.1 発動条件

- **攻撃キー（Space）** を押すと発動します。
- 次の条件を **すべて** 満たすときだけ発動します。
  - 落下していない（生存している）
  - 攻撃使用後の硬直中でない
  - 攻撃のクールダウンが終了している

### 5.2 範囲

- **向いている方向の「隣のマス」から端まで**、パネルがあるマスがすべて対象になります。
- 自分の立っているマスは **対象外**（落ちません）。
- 例：右向きで (3, 5) にいる場合、(4,5), (5,5), …, (9,5) のうちパネルがあるマスが順に落下対象になります。

### 5.3 相手プレイヤーの扱い

- **「攻撃を打ったプレイヤーの向きの延長線上にいる相手」** は、そのマスがもともと攻撃範囲に含まれていなくても **対象に追加** されます。
- つまり、線上に相手が 1 体でもいれば、そのマスまで含めてパネルが落ち、相手も落下します。
- 4 人対戦では、1P が攻撃を打ったときは 2P・3P・4P のうち線上にいる者を、CPU が打ったときは 1P および他 CPU のうち線上にいる者を、それぞれ対象に含めて判定します。

### 5.4 演出・タイミング

1. **光りフェーズ**  
   対象マスが順番に光ります。マスごとに **0.05 秒** 間隔で次のマスへ進みます。
2. **落下フェーズ**  
   光り終了後、対象マスが **0.1 秒** 間隔で順に「落下」扱いになります。
3. 落下扱いになったマスでは、その瞬間に  
   - パネルが除去され、  
   - そのマスにいるプレイヤーは **落下（死亡）** となります。
4. **同時に 2 本以上の攻撃は発動できません。** 既に攻撃演出（パネルエフェクト）が再生中の間は、新たな攻撃は受け付けられません。

### 5.5 クールダウン・硬直

| 項目 | 時間 |
|------|------|
| 攻撃クールダウン | **2 秒**（発動後、次の攻撃まで） |
| 攻撃使用後の硬直 | **0.6 秒**（この間は移動・向き変更・次の攻撃不可） |

- 移動中（マス間を移動している最中）でも、条件を満たしていれば **攻撃は発動可能** です。その場合、移動はキャンセルされ、攻撃が優先されます。

---

## 6. CPU（2P・3P・4P）の挙動

### 6.1 移動

- **0.5 秒** に 1 回、1 マスだけ移動します（移動間隔クールダウン）。
- 移動可能な方向（パネルがあり、他プレイヤーがいない隣接マス）の中から **ランダム** に 1 方向を選びます。
- **向きを変えた直後** は **0.5 秒** の硬直があり、その間は移動も向き変更もできません（CPU のみ）。

### 6.2 攻撃

- **自分が向いている方向の延長線上に、1P または他 CPU が 1 体でもいる** 場合、攻撃を発動します。
- 発動条件（クールダウン・硬直）は 1P と同じです。
- 攻撃の範囲・「線上にいる相手を対象に含める」ルールも 1P と同様です。

---

## 7. 勝敗

### 7.1 落下（死亡）

- 次の場合、プレイヤーは **落下** となり死亡します。
  - 攻撃などでパネルが除去され、その除去されたマスにいた場合
  - 何らかの理由で、自分が乗っているマスのパネルがなくになった場合（例：現在地のパネルが落ちた）

### 7.2 勝者判定

- **1P が落下した場合**  
  → 即座に **2P の勝ち** で対戦終了（CPU の勝ち）。
- それ以外では、生存者が **0 人** のとき **引き分け**、**1 人** のときそのプレイヤーを **勝者** とします。

### 7.3 リザルト後

- 勝敗表示中に **攻撃キー（Space）** を押すと、新規ゲームが開始され、再度 READY → FIGHT!! からプレイできます。

---

## 8. ゲームフロー

1. **タイトル**  
   - 「DROP ZONE」表示。**Space** でゲーム開始。
2. **対戦開始演出**  
   - **READY** を 1.2 秒表示 → **FIGHT!!** を 0.8 秒表示。この間は操作不可。
3. **対戦中**  
   - 1P はキーで移動・向き変更・攻撃。2P・3P・4P は CPU が自動で移動・攻撃。
   - パネル落下・復活、勝敗判定が上記ルールに従って進行。
4. **リザルト**  
   - 勝者表示（「2P WINS!」や「DRAW」など）。**Space** で再戦。

---

## 9. 表示・演出

- **1P**  
  - PNG_Player 配下のスプライトで表示。向きごとに静止・移動（0.1 秒間隔で 2 コマ切り替え）があります。
- **2P・3P・4P**  
  - 色付きの円＋向きを示す三角形で表示（青・赤・黄・緑）。
- **パネル**  
  - 通常はグレー系。攻撃で光っているマスは黄色、落下演出中は別色で表現されます。
- **キャンバス**  
  - 400×400 ピクセル。レスポンシブで `min(90vmin, 480px)` まで拡大表示されます。

---


